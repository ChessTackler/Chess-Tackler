<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chessboard</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #333;
    }

    #board {
      display: grid;
      grid-template-columns: repeat(8, 80px);
      grid-template-rows: repeat(8, 80px);
      border: 4px solid #222;
    }

    .cell {
      width: 80px;
      height: 80px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      position: relative;
    }

    .white { background-color: #f0d9b5; }
    .black { background-color: #b58863; }

    .cell.highlight {
      background-color: #a9a9a9 !important;
    }

    .piece {
      width: 70px;
      height: 70px;
      cursor: pointer;
      user-select: none;
    }
  </style>
</head>
<body>
  <div id="board"></div>

  <script>
    const board = document.getElementById('board');

    const initialPosition = {
      'a8': 'bR', 'b8': 'bN', 'c8': 'bB', 'd8': 'bQ', 'e8': 'bK', 'f8': 'bB', 'g8': 'bN', 'h8': 'bR',
      'a7': 'bP', 'b7': 'bP', 'c7': 'bP', 'd7': 'bP', 'e7': 'bP', 'f7': 'bP', 'g7': 'bP', 'h7': 'bP',
      'a2': 'wP', 'b2': 'wP', 'c2': 'wP', 'd2': 'wP', 'e2': 'wP', 'f2': 'wP', 'g2': 'wP', 'h2': 'wP',
      'a1': 'wR', 'b1': 'wN', 'c1': 'wB', 'd1': 'wQ', 'e1': 'wK', 'f1': 'wB', 'g1': 'wN', 'h1': 'wR',
    };

    const files = ['a','b','c','d','e','f','g','h'];
    const ranks = ['8','7','6','5','4','3','2','1'];

    const state = {}; // board state

    let selected = null;

    function createBoard() {
      for (let r = 0; r < 8; r++) {
        for (let f = 0; f < 8; f++) {
          const square = files[f] + ranks[r];
          const cell = document.createElement('div');
          cell.classList.add('cell', (r + f) % 2 === 0 ? 'white' : 'black');
          cell.id = square;

          if (initialPosition[square]) {
            const img = document.createElement('img');
            img.src = `${initialPosition[square]}.png`;
            img.classList.add('piece');
            img.dataset.piece = initialPosition[square];
            img.dataset.position = square;
            cell.appendChild(img);
            state[square] = initialPosition[square];
          } else {
            state[square] = null;
          }

          cell.addEventListener('click', () => onSquareClick(square));
          board.appendChild(cell);
        }
      }
    }

    function onSquareClick(square) {
      clearHighlights();

      const piece = state[square];

      if (selected && selected !== square && isLegalMove(selected, square)) {
        movePiece(selected, square);
        selected = null;
      } else if (piece) {
        selected = square;
        highlightLegalMoves(square);