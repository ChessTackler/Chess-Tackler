<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chess Board</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
    .board {
      display: grid;
      grid-template-columns: repeat(8, 60px);
      grid-template-rows: repeat(8, 60px);
      border: 2px solid black;
    }
    .cell {
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .white { background-color: #f0d9b5; }
    .black { background-color: #b58863; }
    .highlight {
      background-color: yellow !important;
    }
    img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div class="board" id="board"></div>

  <script>
    const board = document.getElementById('board');
    let selectedCell = null;
    let selectedPiece = null;

    // Initial board setup (FEN style)
    let boardState = [
      ['bR','bN','bB','bQ','bK','bB','bN','bR'],
      ['bP','bP','bP','bP','bP','bP','bP','bP'],
      ['','','','','','','',''],
      ['','','','','','','',''],
      ['','','','','','','',''],
      ['','','','','','','',''],
      ['wP','wP','wP','wP','wP','wP','wP','wP'],
      ['wR','wN','wB','wQ','wK','wB','wN','wR']
    ];

    function renderBoard() {
      board.innerHTML = '';
      for (let row = 0; row < 8; row++) {
        for (let col = 0; col < 8; col++) {
          const cell = document.createElement('div');
          cell.className = `cell ${(row + col) % 2 === 0 ? 'white' : 'black'}`;
          cell.dataset.row = row;
          cell.dataset.col = col;

          const pieceCode = boardState[row][col];
          if (pieceCode) {
            const img = document.createElement('img');
            img.src = `${pieceCode}.png`; // Must match image name, e.g., "wP.png"
            cell.appendChild(img);
          }

          cell.addEventListener('click', () => handleCellClick(row, col));
          board.appendChild(cell);
        }
      }
    }

    function handleCellClick(row, col) {
      const piece = boardState[row][col];
      const isOwnPiece = piece && piece[0] === (turn === 'w' ? 'w' : 'b');

      if (selectedCell) {
        clearHighlights();

        if (selectedCell.row === row && selectedCell.col === col) {
          // Deselect
          selectedCell = null;
          selectedPiece = null;
        } else if (isLegalMove(selectedPiece, selectedCell, { row, col })) {
          // Move
          boardState[row][col] = selectedPiece;
          boardState[selectedCell.row][selectedCell.col] = '';
          turn = turn === 'w' ? 'b' : 'w';
          selectedCell = null;
          selectedPiece = null;
          renderBoard();
        } else if (isOwnPiece) {
          selectedCell = { row, col };
          selectedPiece = piece;
          highlightMoves(piece, row, col);
        } else {
          selectedCell = null;
          selectedPiece = null;
        }
      } else if (isOwnPiece) {
        selectedCell = { row, col };
        selectedPiece = piece;
        highlightMoves(piece, row, col);
      }
    }

    function clearHighlights() {
      document.querySelectorAll('.cell').forEach(cell => {
        cell.classList.remove('highlight');
      });
    }

    function highlightMoves(piece, row, col) {
      clearHighlights();
      for (let r = 0; r < 8; r++) {
        for (let c = 0; c < 8; c++) {
          if (isLegalMove(piece, { row, col }, { row: r, col: c })) {
            const cell = document.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`);
            cell.classList.add('highlight');
          }
        }
      }
    }

    function isLegalMove(piece, from, to) {
      if (!piece) return false;
      const [color, type] = [piece[0], piece[1]];
      const dir = color === 'w' ? -1 : 1;
      const target = boardState[to.row][to.col];
      const targetColor = target ? target[0] : null;

      if (targetColor === color) return false; // Can't capture own piece

      const dr = to.row - from.row;
      const dc = to.col - from.col;

      switch (type) {
        case 'P': {
          // Move forward
          if (dc === 0 && !target) {
            if (dr === dir) return true;
            if ((color === 'w' && from.row === 6 || color === 'b' && from.row === 1) && dr === 2 * dir && !boardState[from.row + dir][from.col]) return true;
          }
          // Capture diagonally
          if (Math.abs(dc) === 1 && dr === dir && target && targetColor !== color) return true;
          return false;
        }
        case 'N':
          return (Math.abs(dr) === 2 && Math.abs(dc) === 1) || (Math.abs(dr) === 1 && Math.abs(dc) === 2);
        case 'B':
          if (Math.abs(dr) !== Math.abs(dc)) return false;
          return isClearPath(from, to);
        case 'R':
          if (dr !== 0 && dc !== 0) return false;
          return isClearPath(from, to);
        case 'Q':
          if (dr === 0 || dc === 0 || Math.abs(dr) === Math.abs(dc)) {
            return isClearPath(from, to);
          }
          return false;
        case 'K':
          return Math.abs(dr) <= 1 && Math.abs(dc) <= 1;
        default:
          return false;
      }
    }

    function isClearPath(from, to) {
      const dr = Math.sign(to.row - from.row);
      const dc = Math.sign(to.col - from.col);
      let r = from.row + dr;
      let c = from.col + dc;
      while (r !== to.row || c !== to.col) {
        if (boardState[r][c]) return false;
        r += dr;
        c += dc;
      }
      return true;
    }

    let turn = 'w'; // White starts

    renderBoard();
  </script>
</body>
</html>